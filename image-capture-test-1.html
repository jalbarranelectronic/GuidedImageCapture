<!DOCTYPE html>
<html>
<head>
  <title>Detector con Marco Irregular (SVG)</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; }
    #video {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      object-fit: cover;
    }
    #overlayCanvas {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
    }
    #feedback {
      position: absolute;
      bottom: 20px; left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background: rgba(0,0,0,0.6);
      color: white;
      border-radius: 10px;
      font-size: 28px;
    }
    #detections {
      position: absolute;
      top: 20px; left: 20px;
      padding: 10px;
      background: rgba(0,0,0,0.6);
      color: #0f0;
      font-family: monospace;
      font-size: 14px;
      border-radius: 8px;
      max-width: 50%;
      max-height: 40%;
      overflow-y: auto;
      white-space: pre-wrap;
    }

     /* 游댃 Forzar landscape en m칩viles */
    @media screen and (orientation:portrait) {
      #container {
        transform: rotate(90deg);
        width: 100vh;
        height: 100vw;
      }
    }
  </style>
</head>
<body>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <canvas id="overlayCanvas"></canvas>
  <div id="feedback">Cargando modelo...</div>
  <div id="detections">Sin detecciones a칰n...</div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const overlayCanvas = document.getElementById('overlayCanvas');
    const feedback = document.getElementById('feedback');
    const detectionsBox = document.getElementById('detections');
    const ctx = canvas.getContext('2d');
    const overlayCtx = overlayCanvas.getContext('2d');

    let marcoPath; // Path del marco irregular

    // 游늷 Path exportado de tu SVG (acortado para ejemplo, pega el completo aqu칤)
    const svgPathData = `m225.24178,18c0,0 -1.15224,-0.76537 -3,0c-1.30656,0.5412 -2.82443,0.09789 -4,2c-0.52573,0.85065 -1.07613,0.61732 -2,1c-1.30656,0.5412 -2.07613,1.61732 -3,2c-1.30656,0.5412 -2.29289,0.29289 -3,1c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1,1 -2,1c-1,0 -1.07613,0.61732 -2,1c-1.30656,0.5412 -2.61731,1.07612 -3,2c-0.5412,1.30656 -1.29289,1.29289 -2,2c-0.70711,0.70711 -1,1 -2,1c-1,0 -0.69344,1.45881 -2,2c-0.92387,0.38268 -1.29289,0.29289 -2,1c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1.29289,0.29289 -2,1c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1.29289,0.29289 -2,1c-0.70711,0.70711 -0.69344,2.45881 -2,3c-0.92387,0.38268 -1.07613,0.61732 -2,1c-1.30656,0.54119 -1.07613,1.61732 -2,2c-1.30656,0.54119 -1.69344,1.45881 -3,2c-0.92387,0.38268 -1.29289,1.29289 -2,2c-0.70711,0.70711 -2.29289,0.29289 -3,1c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1.29289,0.29289 -2,1c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1.29289,0.29289 -2,1c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1.29289,0.29289 -2,1c-0.70711,0.70711 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -1.29289,-0.29289 -2,-1c-0.70711,-0.70711 -1.29289,-0.29289 -2,-1c-0.70711,-0.70711 -1,-1 -2,-1c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -2.29289,-0.70711 -3,0c-0.70711,0.70711 -0.61731,1.07612 -1,2c-0.5412,1.30656 -2,2 -2,3c0,1 0,2 0,3c0,1 -0.4588,1.69344 -1,3c-0.38269,0.92388 0,2 0,3c0,1 -1,1 -1,2c0,1 -1,1 -2,1c-1,0 -1.29289,0.29289 -2,1c-0.70711,0.70711 -2.07613,-0.38268 -3,0c-1.30656,0.5412 -2.07613,0.61732 -3,1c-1.30656,0.5412 -1.29289,1.29289 -2,2c-0.70711,0.70711 -2,1 -3,1c-1,0 -2,1 -3,1c-1,0 -1.69344,0.4588 -3,1c-0.92388,0.38268 -2.29289,-0.70711 -3,0c-0.70711,0.70711 -1,1 -2,1c-2,0 -2,1 -4,1c-1,0 -1.87856,0.49346 -5,1c-1.97417,0.32037 -2,1 -3,1c-1,0 -1.29289,0.29289 -2,1c-0.70711,0.70711 -2.29289,-0.70711 -3,0c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1.69344,0.4588 -3,1c-0.92388,0.38268 -1.15224,0.23463 -3,1c-1.30656,0.5412 -1.29289,1.29289 -2,2c-0.70711,0.70711 -1.69344,0.4588 -3,1c-0.92388,0.38268 -2,1 -3,1c-1,0 -1.29289,0.29289 -2,1c-0.70711,0.70711 -2,1 -3,1c-1,0 -1,1 -2,1c-1,0 -2.69344,0.4588 -4,1c-0.92388,0.38268 -3,1 -4,1c-1,0 -1.29289,0.29289 -2,1c-0.70711,0.70711 -1.69344,0.4588 -3,1c-0.92388,0.38268 -3.07612,0.61732 -4,1c-1.30656,0.5412 -3.69344,2.4588 -5,3c-0.92388,0.38268 -2.29289,0.29289 -3,1c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1,1 -2,1c-1,0 -1,1 -2,1c-1,0 -1.29289,0.29289 -2,1c-0.70711,0.70711 -1.07612,0.61732 -2,1c-1.30656,0.5412 -1.69344,1.4588 -3,2c-0.92388,0.38268 -1.29289,0.29289 -2,1c-0.70711,0.70711 -1.29289,0.29289 -2,1c-0.70711,0.70711 0,2 0,4c0,1 0.30656,2.4588 -1,3c-0.92388,0.38268 -1,1 -2,1c-1,0 -2.4588,-0.30656 -3,1c-0.38268,0.92388 -0.61732,2.07612 -1,3c-0.5412,1.30656 -2.4588,1.69344 -3,3c-0.38268,0.92387 0.38268,2.07613 0,3c-0.5412,1.30656 -1,2 -1,3c0,1 -0.29289,1.29289 -1,2c-1.41421,1.41422 0.70711,3.29289 0,4c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -0.61732,1.07613 -1,2c-0.5412,1.30656 -1,2 -1,3c0,1 -0.4588,1.69344 -1,3c-0.38268,0.92387 0.38268,2.07613 0,3c-0.5412,1.30656 -0.61732,2.07613 -1,3c-0.5412,1.30656 -0.29289,2.29289 -1,3c-0.70711,0.70711 -1,1 -1,2c0,1 -1,1 -1,2c0,1 0.70711,2.29289 0,3c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1.29289,0.29289 -2,1c-0.70711,0.70711 0.70711,2.29289 0,3c-0.70711,0.70711 -1,1 -1,2c0,1 -1,2 -1,3c0,1 0.22975,2.02675 0,3c-0.51374,2.17625 -2,3 -2,5c0,1 -0.29289,1.29289 -1,2c-0.70711,0.70711 0,2 0,3c0,1 0,2 0,3c0,1 0,2 0,3c0,1 1,2 1,3c0,1 0.29289,1.29289 1,2c0.70711,0.70711 -0.70711,2.29289 0,3c0.70711,0.70711 1.29289,0.29289 2,1c0.70711,0.70711 0,2 0,3c0,1 0.70711,2.29289 0,3c-0.70711,0.70711 -1.29289,0.29289 -2,1c-0.70711,0.70711 -0.69344,2.4588 -2,3c-0.92388,0.38269 -1.29289,0.29289 -2,1c-0.70711,0.70711 -1,1 -1,2c0,1 -0.29289,1.29289 -1,2c-0.70711,0.70711 0,2 0,3c0,1 0.70711,2.29289 0,3c-0.70711,0.70711 -1.70711,1.29289 -1,2c0.70711,0.70711 1.4588,0.69344 2,2c0.38268,0.92387 0.29289,1.29289 1,2c0.70711,0.70711 2,0 3,0c1,0 1.29289,1.29289 2,2c0.70711,0.70711 1.61732,0.07613 2,1c0.5412,1.30656 1.29289,2.29289 2,3c0.70711,0.70711 2,0 3,0c1,0 1,1 2,1c1,0 2,0 3,0c1,0 1,1 2,1c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2.29289,-0.70711 3,0c0.70711,0.70711 1.29289,1.29289 2,2c0.70711,0.70711 0.29289,1.29289 1,2c0.70711,0.70711 2.29289,-0.70711 3,0c0.70711,0.70711 0.29289,1.29289 1,2c0.70711,0.70711 2,0 3,0c1,0 1.29289,0.29289 2,1c0.70711,0.70711 1.29289,0.29289 2,1c0.70711,0.70711 1.29289,0.29289 2,1c0.70711,0.70711 1.29289,0.29289 2,1c0.70711,0.70711 1.29289,0.29289 2,1c0.70711,0.70711 0,2 1,2c1,0 0.29289,1.29291 1,2c0.70711,0.70709 1.29289,0.29291 2,1c0.70711,0.70709 1,1 2,1c1,0 1.69344,0.4588 3,1c0.92388,0.38269 1.29289,0.29291 2,1c0.70711,0.70709 2,0 3,0c1,0 2,0 3,0c1,0 1.69344,0.4588 3,1c0.92388,0.38269 1.69344,0.4588 3,1c0.92388,0.38269 2,1 3,1c1,0 1,1 2,1c1,0 2.29289,-0.70709 3,0c0.70711,0.70709 1,1 2,1c1,0 2.29289,-0.70709 3,0c0.70711,0.70709 1,1 2,1c1,0 2,0 3,0c1,0 3,0 4,0c1,0 1.29289,0.29291 2,1c0.70711,0.70709 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 1.29289,-0.29291 2,-1c1.41422,-1.41422 3.29289,-0.29291 4,-1c0.70711,-0.70709 0.29289,-1.29291 1,-2c0.70711,-0.70709 1.29289,-0.29291 2,-1c0.70711,-0.70709 0.29289,-1.29291 1,-2c0.70711,-0.70709 1.29289,-0.29291 2,-1c0.70711,-0.70709 1,-1 1,-2c0,-1 0.29289,-2.29291 1,-3c0.70711,-0.70711 2,0 3,0c1,0 3,1 5,1c1,0 2,1 4,1c2,0 4.69344,0.4588 6,1c0.92387,0.38269 2,0 3,0c1,0 2,1 3,1c1,0 2,0 3,0c1,0 2,0 4,0c2,0 3,0 4,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c2,0 3,0 4,0c2,0 3,0 4,0c1,0 2,0 3,0c1,0 2.29289,-0.70709 3,0c0.70711,0.70709 1,1 2,1c1,0 2,0 3,0c1,0 2,1 3,1c1,0 2.07613,-0.38269 3,0c1.30656,0.5412 2,1 3,1c1,0 2,0 3,0c1,0 3,0 4,0c1,0 2,0 4,0c1,0 2.58578,-1.41422 4,0c0.70711,0.70709 1,1 2,1c1,0 2.0535,-0.4595 4,0c2.17625,0.51373 6.72958,3.37866 8,4c7.24245,3.54218 10.69345,2.4588 12,3c0.92389,0.38269 2,0 3,0c1,0 1.29291,-1.29291 2,-2c0.70709,-0.70709 1.69345,-0.4588 3,-1c0.92389,-0.38269 1.29291,-0.29291 2,-1c0.70709,-0.70709 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2.02676,-0.22977 3,0c2.17624,0.51373 3,1 4,1c1,0 2,0 3,0c1,0 2,0 3,0c1,0 4,0 6,0c1,0 3,1 4,1c1,0 1,1 2,1c1,0 1.29291,0.29291 2,1c0.70709,0.70709 2.07611,-0.38269 3,0c1.30655,0.5412 1.29291,1.29291 2,2c0.70709,0.70709 1.29291,0.29291 2,1c0.70709,0.70709 2.29291,0.29291 3,1c0.70709,0.70709 1.07611,1.61731 2,2c1.30655,0.5412 1.0979,1.82443 3,3c0.85065,0.52573 1,1 2,1c1,0 2,1 3,1c1,0 2.29291,-0.70709 3,0c0.70709,0.70709 1,1 2,1c1,0 1.69345,0.4588 3,1c0.92389,0.38269 2,0 3,0c2,0 3,0 4,0c1,0 2,0 3,0c1,0 2,1 3,1c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 1,1 2,1c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2.29291,0.70709 3,0c0.70709,-0.70709 1,-1 2,-1c1,0 1.29291,-0.29291 2,-1c0.70709,-0.70709 1.29291,-0.29291 2,-1c1.41422,-1.41422 3.07611,-0.61731 4,-1c1.30655,-0.5412 1.69345,-1.4588 3,-2c0.92389,-0.38269 1.29291,-1.29291 2,-2c0.70709,-0.70709 2.29291,-0.29291 3,-1c0.70709,-0.70709 0.69345,-1.4588 2,-2c0.92389,-0.38269 1.29291,-0.29291 2,-1c0.70709,-0.70709 0.29291,-1.29291 1,-2c0.70709,-0.70709 1.29291,-0.29291 2,-1c0.70709,-0.70709 0.29291,-1.29291 1,-2c0.70709,-0.70709 0.47427,-1.14935 1,-2c1.17557,-1.9021 2.61731,-2.07611 3,-3c0.5412,-1.30655 2,-1 2,-2c0,-1 1,-1 1,-2c0,-1 -0.70709,-2.29291 0,-3c0.70709,-0.70709 1,-1 1,-2c0,-1 0,-2 0,-3c0,-1 -0.38269,-2.07613 0,-3c0.5412,-1.30656 1.4588,-1.69344 2,-3c0.38269,-0.92387 -0.70709,-2.29289 0,-3c0.70709,-0.70711 0.29291,-1.29289 1,-2c0.70709,-0.70711 2,-1 3,-1c1,0 3,-1 4,-1c1,0 2,0 3,0c1,0 2,0 3,0c1,0 3,-1 4,-1c1,0 2.15225,0.76537 4,0c1.30655,-0.5412 2.02676,-0.77025 3,-1c2.17624,-0.51375 4,-2 5,-2c1,0 1.29291,-0.29289 2,-1c0.70709,-0.70711 1.82376,-0.48625 4,-1c2.91974,-0.68925 5,0 6,0c1,0 1,-1 3,-1c1,0 2.93414,-0.14429 5,-1c2.92157,-1.21014 4,-2 5,-2c1,0 1.29291,-0.29289 2,-1c0.70709,-0.70711 2,0 3,0c1,0 2,-1 3,-1c1,0 3.07843,0.21014 6,-1c2.06586,-0.85571 3,-1 4,-1c1,0 2.29291,0.70711 3,0c0.70709,-0.70711 1,-1 2,-1c1,0 3.07611,0.38269 4,0c1.30655,-0.5412 2,-1 3,-1c1,0 1.69345,-0.4588 3,-1c0.92389,-0.38269 2,-1 3,-1c1,0 1.29291,-0.29289 2,-1c0.70709,-0.70711 2,0 3,-1c1,-1 2,-1 3,-1c1,0 2,0 3,0c1,0 2.87866,-2.12132 5,0c0.70709,0.70711 1.07611,0.61731 2,1c1.30658,0.5412 1.4588,2.69344 2,4c0.38269,0.92387 0.29291,1.29289 1,2c0.70709,0.70711 2.07611,1.61731 3,2c1.30658,0.5412 1,2 2,2c1,0 2.07611,-0.38269 3,0c1.30658,0.5412 1.29291,1.29289 2,2c0.70709,0.70711 1.69342,0.4588 3,1c0.92389,0.38269 2,1 3,1c1,0 2.29291,-0.70711 3,0c0.70709,0.70711 1.82373,1.48625 4,2c0.97327,0.22975 2,0 4,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2.29291,0.70711 3,0c0.70709,-0.70711 1,-1 2,-2c1,-1 1.29291,-1.29289 2,-2c0.70709,-0.70711 1.4588,-0.69344 2,-2c0.38269,-0.92387 0.61731,-1.07613 1,-2c0.5412,-1.30656 1.29291,-2.29289 2,-3c0.70709,-0.70711 1.29291,-1.29289 2,-2c0.70709,-0.70711 1.4588,-0.69344 2,-2c0.38269,-0.92387 0.29291,-1.29289 1,-2c0.70709,-0.70711 1,-2 1,-3c0,-1 1,-1 1,-2c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0.4588,-1.69344 1,-3c0.38269,-0.92387 -0.38269,-2.07613 0,-3c0.5412,-1.30656 1.4588,-1.69344 2,-3c0.38269,-0.92387 1,-2 1,-3c0,-1 1,-2 1,-3c0,-1 0.29291,-2.29289 1,-3c0.70709,-0.70711 1,-1 1,-2c0,-1 1,-1 1,-2c0,-1 0.29291,-1.29289 1,-2c0.70709,-0.70711 0.29291,-1.29289 1,-2c0.70709,-0.70711 0.61731,-1.07613 1,-2c0.5412,-1.30656 1.29291,-1.29289 2,-2c0.70709,-0.70711 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 1,-1 1,-2c0,-1 1,-2 1,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-2 0,-3 0,-4c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 -1,-1 -1,-2c0,-1 -0.4588,-1.69344 -1,-3c-0.38269,-0.92388 0,-2 0,-3c0,-1 -1,-1 -1,-2c0,-1 0,-2 0,-3c0,-1 -0.29291,-1.29289 -1,-2c-0.70709,-0.70711 0,-2 0,-3c0,-1 -0.29291,-1.29289 -1,-2c-0.70709,-0.70711 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 0,-2 0,-3c0,-1 -0.29291,-1.29289 -1,-2c-0.70709,-0.70711 0.70709,-2.29289 0,-3c-0.70709,-0.70711 -1,-1 -2,-1c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -1.29291,-1.29289 -2,-2c-0.70709,-0.70711 -1.4588,-0.69344 -2,-2c-0.38269,-0.92388 -0.29291,-1.29289 -1,-2c-0.70709,-0.70711 -0.4588,-1.69344 -1,-3c-0.38269,-0.92388 -1,-1 -1,-2c0,-1 -0.29291,-1.29289 -1,-2c-0.70709,-0.70711 0.70709,-2.29289 0,-3c-0.70709,-0.70711 -1.95514,-0.54916 -3,-4c-0.28979,-0.95709 -0.61731,-2.07612 -1,-3c-0.5412,-1.30656 -2.29291,-1.29289 -3,-2c-0.70709,-0.70711 -0.61731,-2.07612 -1,-3c-0.5412,-1.30656 -2,-2 -3,-3c-1,-1 -2,-2 -3,-3c-1,-1 -2.29291,-1.29289 -3,-2c-0.70709,-0.70711 -1.4588,-0.69344 -2,-2c-0.38269,-0.92388 -1.29291,-0.29289 -2,-1c-0.70709,-0.70711 -1.29291,-1.29289 -2,-2c-0.70709,-0.70711 -0.29291,-1.29289 -1,-2c-0.70709,-0.70711 -1.69342,-1.45881 -3,-2c-0.92389,-0.38268 -2.29291,-0.29289 -3,-1c-0.70709,-0.70711 -1.29291,-1.29289 -2,-2c-0.70709,-0.70711 -0.29291,-1.29289 -1,-2c-0.70709,-0.70711 -1.29291,-0.29289 -2,-1c-0.70709,-0.70711 -1.29291,-0.29289 -2,-1c-0.70709,-0.70711 -0.69342,-1.4588 -2,-2c-0.92389,-0.38268 -1.69342,-1.4588 -3,-2c-0.92389,-0.38268 -1,-1 -2,-1c-1,0 -1.29291,-0.29289 -2,-1c-0.70709,-0.70711 -0.69342,-1.4588 -2,-2c-0.92389,-0.38268 -1.07611,-0.61732 -2,-1c-1.30658,-0.5412 -2.29291,-0.29289 -3,-1c-0.70709,-0.70711 -1.29291,-1.29289 -2,-2c-0.70709,-0.70711 -1.07611,-0.61732 -2,-1c-1.30658,-0.5412 -1.61731,-1.07612 -2,-2c-0.5412,-1.30656 -2.29291,-0.29289 -3,-1c-0.70709,-0.70711 -0.29291,-1.29289 -1,-2c-0.70709,-0.70711 -2,0 -3,-1c-1,-1 -1.69345,-1.4588 -3,-2c-0.92389,-0.38268 -2.69345,-1.4588 -4,-2c-0.92389,-0.38268 -1.82376,-0.48626 -4,-1c-0.97324,-0.22975 -1.29291,-0.29289 -2,-1c-0.70709,-0.70711 -2,-1 -3,-1c-1,0 -2.29291,0.70711 -3,0c-0.70709,-0.70711 -1,-1 -2,-1c-1,0 -2.07611,0.38268 -3,0c-1.30655,-0.5412 -2,-1 -3,-1c-1,0 -2.07611,0.38268 -3,0c-1.30655,-0.5412 -1.69345,-1.4588 -3,-2c-0.92389,-0.38268 -2,0 -3,0c-2,0 -4.69345,-0.4588 -6,-1c-2.77164,-1.14805 -4,0 -5,0c-1,0 -2,0 -5,0c-4,0 -6,0 -7,0c-2,0 -4,0 -5,0c-1,0 -5,0 -7,0c-2,0 -3,0 -4,0c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -3,1 -5,1c-2,0 -3,0 -4,0c-1,0 -2,0 -3,0c-2,0 -4,0 -5,0c-2,0 -4,0 -6,0c-1,0 -2,0 -6,0c-2,0 -6.02582,-0.32036 -8,0c-3.12143,0.50654 -6,1 -9,1c-1,0 -2,0 -4,0c-1,0 -3,0 -5,0c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -2,0 -7,0c-1,0 -3,0 -5,0c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -2,0 -4,0c-6,0 -9,0 -15,0c-2,0 -5,0 -7,0c-1,0 -2,0 -3,0c-2,0 -4,0 -7,0c-1,0 -3,0 -4,0c-1,0 -1,1 -2,1c-1,0 -2,0 -3,0c-1,0 -2,0 -4,0c-2,0 -6,0 -8,0c-2,0 -3,0 -5,0c-1,0 -3,0 -5,0c-2,0 -6,0 -7,0c-4,0 -5,1 -6,1c-1,0 -2.02676,-0.22975 -3,0c-2.17624,0.51374 -3,1 -4,1c-2,0 -3,0 -4,0c-1,0 -1.29289,0.29289 -2,1c-0.70711,0.70711 -2,0 -3,0c-1,0 -2,1 -3,1c-1,0 -2.61731,0.07612 -3,1c-0.5412,1.30656 -2.58578,-0.41421 -4,1c-0.70711,0.70711 -0.69344,1.4588 -2,2c-0.92387,0.38268 -1.29289,0.29289 -2,1c-0.70711,0.70711 -0.29289,1.29289 -1,2c-0.70711,0.70711 -1,1 -2,1c-1,0 -0.69344,1.4588 -2,2c-0.92387,0.38268 -1,1 -2,1c-1,0 -3,1 -4,2l-2,0l0,1`;

    async function initCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }});
      video.srcObject = stream;

      return new Promise(resolve => {
        video.onloadedmetadata = () => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          overlayCanvas.width = video.videoWidth;
          overlayCanvas.height = video.videoHeight;

          // Crear Path2D a partir del path SVG
          marcoPath = new Path2D(svgPathData);

          // 游댳 Ajusta con los valores del viewBox de tu SVG
          const svgWidth = 597;  // ancho original del SVG
          const svgHeight = 289;  // alto original del SVG

          overlayCtx.save();

          // Llevar el path al centro del canvas
          overlayCtx.translate(overlayCanvas.width / 2, overlayCanvas.height / 2);

          // Escalar el path para que encaje en el canvas manteniendo proporci칩n
      const scaleFactor = Math.min(
        overlayCanvas.width / svgWidth,
        overlayCanvas.height / svgHeight
      );
      overlayCtx.scale(scaleFactor, scaleFactor);

      // Mover el path para centrarlo (de su ancho/alto original)
      overlayCtx.translate(-svgWidth / 2, -svgHeight / 2);

          // Dibujar el marco
          overlayCtx.strokeStyle = "lime";
          overlayCtx.lineWidth = 4 / scaleFactor; // ajusta grosor para que no se deforme
          overlayCtx.setLineDash([10 / scaleFactor, 6 / scaleFactor]);
          overlayCtx.stroke(marcoPath);
          overlayCtx.restore();

          resolve();
        };
      });
    }

    // Funci칩n para verificar si un rect치ngulo est치 dentro del path
    function rectDentroDePath(x, y, w, h, path, ctx) {
      const puntos = [
        [x, y], [x+w, y],
        [x, y+h], [x+w, y+h]
      ];
      return puntos.every(([px, py]) => ctx.isPointInPath(path, px, py));
    }

    async function runDetection() {
      const model = await cocoSsd.load();
      feedback.innerText = "Modelo cargado. Busca el auto...";

      setInterval(async () => {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        const predictions = await model.detect(canvas);

        // 游릭 Mostrar detecciones en pantalla
        if (predictions.length > 0) {
          detectionsBox.innerText = predictions.map(p =>
            `${p.class} (${(p.score*100).toFixed(1)}%)`
          ).join("\n");
        } else {
          detectionsBox.innerText = "Sin detecciones";
        }

        const car = predictions.find(p =>
          ["car", "truck", "bus"].includes(p.class)
        );

        console.log("Detecciones:", predictions); // 游댌 Debug en consola

        if (predictions.length > 0) {
            feedback.innerText = "Detectado: " + predictions.map(p => p.class).join(", ");
            }

        if (car) {
          const [x, y, w, h] = car.bbox;

          // Verificar si el rect치ngulo del auto est치 dentro del marco irregular
          const dentro = rectDentroDePath(x, y, w, h, marcoPath, overlayCtx);

          // Comparar proporci칩n de 치reas (auto vs marco aproximado)
          const carArea = w * h;
          const marcoBox = overlayCanvas.width * 0.6 * overlayCanvas.height * 0.3;
          const proportion = carArea / marcoBox;

          if (!dentro) {
            feedback.innerText = "Ajusta la c치mara para centrar el auto 游댃";
          } else if (proportion > 1.2) {
            feedback.innerText = "Muy cerca 游뚱拘勇";
          } else if (proportion < 0.7) {
            feedback.innerText = "Muy lejos 游뚱俱뫮잺";
          } else {
            feedback.innerText = "춰Perfecto! 游닞";
          }
        } else {
          feedback.innerText = "No detecto el auto, ajusta la c치mara.";
        }
      }, 1000);
    }

    initCamera().then(runDetection);
  </script>
</body>
</html>
